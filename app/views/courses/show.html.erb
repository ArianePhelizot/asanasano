<div class="wrapper-devise-form">
  <div class="container">
    <div class="row">
      <div class="col-xs-12 col-sm-10 col-sm-offset-1 col-md-8 col-md-offset-2 col-lg-6 col-lg-offset-3">
        <div class="wrapper-login">
          <div class="row">
            <div class="col-xs-12 pencil">
              <% if policy(@course).edit? %>
                <%= link_to edit_group_course_path(@group, @course) do %>
                  <i class="fa fa-pencil fa-lg" aria-hidden="true"></i>
                <% end %>
              <% end %>
            &nbsp; <!-- espace -->
              <% if policy(@course).destroy? %>
                <%= link_to course_path(@course), method: "delete" do %>
                  <i class="fa fa-trash-o fa-lg" aria-hidden="true"></i>
                <% end %>
              <% end %>
            </div>
            <div class="col-xs-12">
              <div class="text-center">
                 <h1><%= @course.name %></h1>
              </div>
            </div>
          </div>
         <hr>
          <div class="row">
            <div class="col-xs-6 col-xs-offset-3 col-sm-3 col-sm-offset-9 course-coach-info">
              <% if @course.coach&.photo? %> <!-- le & à la fin de coach teste si coach exist. Cela évite d'appeler la méthode photo sur le coach si ce dernier n'existe pas -->
                <%= cl_image_tag @course.coach_photo.path, gravity: :face,
                                                           width: 50,
                                                           crop: :fill,
                                                           radius: :max %>
              <!-- on peut appeler coach_photo sur @course car on a délégué dans le model Coach, la méthode photo à Course avec prefix: true -->
              <% else %>
                <%= image_tag "https://maxcdn.icons8.com/Share/icon/Users//user_male_circle_filled1600.png" %>
              <% end %>
              <% if @course.coach&.first_name.present?  %>
                <p>Coach: <%= @course.coach.first_name %></p> <!-- on peut appeler first_name sur #coach même si ce dernier n'a pas d'attribut first_name car on a délégué first_name au model User -->
              <% else %>
                <p>Coach</p>
              <% end %>
            <br>
            </div>
            <div class="col-xs-12 col-sm-8">
              <p><strong>Sport:</strong> <%= @course.sport.name %></p>
              <p><strong>Adresse:</strong> <%= @course.address %></p>
              <p><strong>Point de rendez-vous:</strong> <%= @course.meeting_point %></p>
              <p><strong>Nombre maximum de participant:</strong> <%= @course.capacity_max %></p>
              <p><strong>Détails:</strong> <%= @course.details %></p>
              <p><strong>Statut:</strong> <%= @course.status.capitalize %>.
              <!-- precisions sur les implications liées au statut -->
                <% if @course.draft? && @course.publishable? %> </p>
                  <p>
                    ATTENTION, ce cours n'est pas encore mis en ligne. Pour que l'ensemble des membres du groupe <%= @course.group.name %> puissent y avoir accès et réserver leur première séance. il est nécessaire au prélable de le publier.
                  </p>
                <% elsif @course.draft? %>
                  <p>
                    ATTENTION, ce cours n'a pas été encore mis en ligne. Pour pouvoir le publier, l'ensemble des champs obligatoires doivent être renseignés et une première séance doit être programmée.
                  </p>
                <% elsif @course.active? && @course.depublishable? %>
                  <p>
                    Ce cours est en ligne. Il est visible à l'ensemble des membres du groupe <%= @course.group.name} %>.
                  </p>
                <% else %>
                  <p>
                    Ce cours est en ligne. Il est visible à l'ensemble des membres du groupe <%= @course.group.name %>. Pour le désactiver, il est nécessaire de s'assurer au préalable qu'il n'y ait aucune séance associée.
                  </p>
                <% end %>
              <p><strong>Contenu du cours:</strong> <%= @course.content %></p>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-xs-12 col-sm-10 col-sm-offset-1 col-md-8 col-md-offset-2 col-lg-6 col-lg-offset-3">
        <div class="wrapper-login">
          <div class="row">
            <div class="col-xs-12 add-icon">
              <% if policy(@course).edit? %>
                <%= link_to new_course_slot_path(@course) do %>
                  <i class="fa fa-plus-square-o fa-2x" aria-hidden="true"></i>
                <% end %>
              <% end %>
            </div>
          </div>
          <% if !@course.slots.any? %>
            <div class="row">
              <div class="col-xs-12">
                <p>Il n'y a pas de séance programmée pour ce cours.</p>
                <br>
                <p>
                  Contacter <%= @course.group.owner.first_name %> <%= @course.group.owner.last_name %> pour en savoir plus: <%= @course.group.owner.email %>.
                </p>
              </div>
            </div>
          <% else %>
            <% @course.slots.each do |slot| %>
              <div class="row">
                <div class="col-xs-12 col-sm-6 col-sm-offset-3">
                  <div class="text-center">
                    <h3>Les séances</h3>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-xs-6">
                  <p><i class="fa fa-calendar" aria-hidden="true"></i>  <%= l(slot.date, format: :long) %></p>
                  <p><i class="fa fa-clock-o" aria-hidden="true"></i>  <%= slot.start_at.strftime("%H:%M") %> - <%= slot.end_at.strftime("%H:%M") %></p> <!-- affiche start_at sous le format 14:06 --><!-- affiche le end_at sous le format 14:06 -->
                  <p><i class="fa fa-user-o" aria-hidden="true"></i>  <%= slot.users.count %> / <%= @course.capacity_max %></p>
                  <p><strong>Statut:</strong> <%= slot.status %></p>
                </div>
                <div class="col-xs-6 price-slot">
                  <p><%= humanized_money_with_symbol slot.price %></p> <!-- helper qui affiche le prix avec € -->
                  <%= form_tag orders_path do %>
                    <%= hidden_field_tag 'slot_id', slot.id %>
                    <%= submit_tag 'Acheter', class: "buy-btn btn-sm" %>
                  <% end %>
                </div>
                <br>
                <div class="col-xs-12">
                  <div class="text-center">
                    <% if policy(slot).edit? %>
                      <%= link_to edit_course_slot_path(@course, slot) do %>
                        <i class="fa fa-pencil fa-lg" aria-hidden="true"></i>
                      <% end %>
                    <% end %>
                    <hr>
                  </div>
                </div>
              </div>
            <% end %>
          <% end %>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-xs-12 col-sm-10 col-sm-offset-1 col-md-8 col-md-offset-2 col-lg-6 col-lg-offset-3">
        <div class="wrapper-login">
          <div class="row">
            <div class="col-xs-4">
              <% if policy(@course).edit? %>
                <%= link_to "Editer le cours", edit_group_course_path(@group, @course), class: "btn btn-courses btn-sm" %>
              <% end %>
            </div>
            <div class="col-xs-4">
              <% if policy(@course).publish? && @course.publishable? %>
                <%= link_to "Publier le cours", course_publish_path(@course),
                    method: "patch",
                    data: { confirm: "Prêt à publier le cours? Cette action déclenchera l'envoi d'un email automatique à l'ensemble des membres du groupe qui pourront alors réserver, s'ils le souhaient, une séance." }, class: "btn btn-courses btn-sm" %>
              <% elsif policy(@course).publish? && @course.draft? && !@course.publishable? %>
                <a href="#" class = "btn btn-courses btn-sm disabled" >Publier le cours</a>
              <% elsif policy(@course).publish? && @course.active? && @course.depublishable? %>
                  <%= link_to "Désactiver le cours", course_depublish_path(@course),
                      method: "patch",
                      data: { confirm: "Prêt à désactiver ce cours? Il ne sera alors plus visible aux membres du groupe" }, class: "btn btn-courses btn-sm" %>
              <% elsif @course.active? && !@course.depublishable?%>
                <a href="#" class = "btn btn-courses btn-sm disabled" >Désactiver le cours</a>
              <% end %>
              <br>
            </div>
            <div class="col-xs-4">
              <% if policy(@course).destroy? %>
                <%= link_to "Supprimer le cours", course_path(@course), method: "delete", class: "btn btn-courses btn-sm" %>
              <% end %>
              <br>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
